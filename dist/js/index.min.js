function numToString(numm) {
    var stringArray = [];
    var numToStringAction = function (nnum) {
        var num = nnum - 1;
        var a = parseInt(num / 26);
        var b = num % 26;
        stringArray.push(String.fromCharCode(64 + parseInt(b + 1)));
        if (a > 0) {
            numToStringAction(a);
        }
    }
    numToStringAction(numm);
    return stringArray.reverse().join("");
}

/**
 * 表格表头单元格
 */
function HeaderCell(config, pNode) {
    this.el = null;
    this.txtEl = null;

    this.render = function(parentNode) {
        let el = document.createElement("li");
        this.txtEl = document.createElement("span");
        el.appendChild(this.txtEl);
        this.split = document.createElement("div");
        this.split.classList.add("header-split");
        el.appendChild(this.split);
        this.setIndex.call(this.txtEl, config.index);
        el.data = {
            ...config,
            component: 'HeaderCell'
        };

        if(parentNode) {
            parentNode.appendChild(el);
        }

        return el;
    }

    //设置展示下标
    this.setIndex = function(index) {
        (this.txtEl || this).innerHTML = config.headertype === 'top' ? numToString(index) : index;
    }

    //更新状态
    this.refresh = function() {
        let index = 0;
        if(config.headertype === 'left') {
            if(config.spread.freezeArea.top < config.index) {
                index = config.index + config.spread.viewX - 1;
            } else {
                index = config.index - 1;
            }
        } else {
            if(config.spread.freezeArea.left < config.index) {
                index = config.index + config.spread.viewY - 1;
            } else {
                index = config.index - 1;
            }
        }

        let headIndex = config.spread.selected.findIndex(([x, y]) =>
            config.headertype === 'left' ? index === x : index === y
        );

        if(headIndex >= 0) {
            this.el.classList.add('active');
        } else {
            this.el.classList.remove('active');
        }
    }

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}

/**
 * 表格表头
 */
function HeaderList(config, pNode) {

    this.data = [];

    this.setStartIndex = function(startIndex) {
        this.data.forEach((i, index) => {
            if(config.headertype === 'top') {
                if(index < config.spread.freezeArea.left) {
                    i.setIndex(index + 1);
                } else {
                    i.setIndex(startIndex + index + 1);
                }
            } else if(config.headertype === 'left') {
                if(index < config.spread.freezeArea.top) {
                    i.setIndex(index + 1);
                } else {
                    i.setIndex(startIndex + index + 1);
                }
            }
        });
    }

    this.refresh = function() {
        this.data.forEach((i, index) => {
            i.refresh();
        });
    }

    this.render = function(parentNode) {
        let el = document.createElement("ul");
        el.classList.add('header-list');
        el.setAttribute('type', config.headertype);
        el.data = {
            ...config,
            component: 'HeaderList'
        };
        Array(config.count).fill('').map((i, index) => {
            let item = new HeaderCell({
                ...config,
                index: config.spread.viewX + index + 1
            }, el);
            this.data.push(item);
        });
        if(parentNode) {
            parentNode.appendChild(el);
        }
        return el;
    }

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}

function ScrollBar(config, pNode) {
    this.el = null;
    this.txtEl = null;

    this.render = function(parentNode) {
        let el = document.createElement("div");
        el.classList.add('scroll-bar');
        el.data = {
            ...config,
            component: 'ScrollBar'
        };

        if(parentNode) {
            parentNode.appendChild(el);
        }

        return el;
    }

    //更新状态
    this.refresh = function() {
    }

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}

/**
 * 滚动条
 */
function Scroll(config, pNode) {
    this.el = null;
    this.data = [];
    this.scrollBar = null;
    this.isStart = false;
    this.initLocation = null;
    this.value = 0;

    /**
     * 设置滚动条滑块长度
     */
    this.refresh = function() {
        if(config.type == 'vertical') {
            let _scrollHeight = this.el.offsetHeight,
                _pageHeight = window.innerHeight,
                _pageScrollHeight = Array(config.spread.maxRowCount).fill('').map((i, index) => config.spread.getRowHeight(index)).reduce((a, b) => a + b);
            this.scrollBar.el.style.height = (_scrollHeight * _pageHeight / _pageScrollHeight) + 'px';
        } else if (config.type == 'horizontal') {
            let _scrollWidth = this.el.offsetWidth,
                _pageWidth = window.innerWidth,
                _pageScrollWidth = Array(config.spread.maxColCount).fill('').map((i, index) => config.spread.getColWidth(index)).reduce((a, b) => a + b);
            this.scrollBar.el.style.width = (_scrollWidth * _pageWidth / _pageScrollWidth) + 'px';
        }
    }

    /**
     * 设置滚动条滑块位置
     */
    this.refreshLocation = function() {
        if(config.type == 'vertical') {
            let _scrollHeight = this.el.offsetHeight;
            this.value = _scrollHeight * config.spread.viewX / config.spread.maxRowCount;
            this.scrollBar.el.style.transform = 'translateY(' + this.value + 'px)';
        } else if (config.type == 'horizontal') {
            let _scrollWidth = this.el.offsetWidth;
            this.value = _scrollWidth * config.spread.viewY / config.spread.maxColCount;
            this.scrollBar.el.style.transform = 'translateX(' + this.value + 'px)';
        }
    }

    this.render = function(parentNode) {
        this.el = document.createElement("div");
        this.el.classList.add('scroll', 'scroll-' + config.type);
        this.el.data = {
            ...config,
            component: 'Scroll'
        };
        // this.el.addEventListener('mousedown', e => {
        //     switch (e.target.data.component) {
        //         case 'Scroll':

        //             break;
        //         case 'ScrollBar':
        //             this.isStart = true;
        //             // console.log(e.offsetX);
        //             if(config.type == 'vertical') {
        //                 let _scrollHeight = this.el.offsetHeight;
        //             } else if (config.type == 'horizontal') {
        //                 let _scrollWidth = this.el.offsetWidth;
        //             }
        //             break;
        //     }
        // });
        // this.el.addEventListener('mousemove', e => {
        //     if(this.isStart) {

        //     }
        // });
        // document.body.addEventListener('mouseup', e => {
        //     this.isStart = false;
        // });
        this.scrollBar = new ScrollBar({
            ...config
        }, this.el);
        if(parentNode) {
            parentNode.appendChild(this.el);
        }
        return this.el;
    }

    if(pNode) {
        this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}
function Input(config, pNode) {

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}

function TextBox(config, pNode) {
    this.el = null;
    // this.call(new Input(config));

    //按键事件
    this.onKeyPress = function(event) {
        config.spread.inputKeyPress(
            config.rowIndex,
            config.colIndex,
            event
        );
    }

    this.render = function(parentNode) {
        let el = null;

        if(config.spread.active[0] === config.rowIndex + config.spread.viewX && config.spread.active[1] === config.colIndex) {
            el = document.createElement("textarea");
            el.type = "text";
            el.classList.add("data-txt-input");
            el.onkeydown = this.onKeyPress;
        } else {
            el = document.createElement("span");
        }

        el.classList.add("data-txt");
        el.freeze = config.freeze;
        // el.parentNode.style.width = config.spread.getColWidth(config.colIndex) + 'px';
        // el.parentNode.style.height = config.spread.getRowHeight(config.rowIndex + config.spread.viewX) + 'px';
        el.data = {
            ...config,
            component: 'TextBox'
        };

        if(parentNode) {
            parentNode.appendChild(el);
        }
        this.el = el;
        return el;
    };

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}

/**
 * @class 单元格
 */
function Cell(config, pNode) {
    this.el = null;
    this.data = config;
    this.isEdit = false;
    this.selected = {
        top: false,
        botom: false,
        left: false,
        right: false
    };

    this.render = function(parentNode) {
        let el = document.createElement("td");
        el.data = {
            ...config,
            component: 'Cell'
        };
        el.addEventListener('mousedown', this.onMouseDown.bind(this));
        el.addEventListener('mousemove', this.onMouseMove.bind(this));
        el.addEventListener('mouseout', this.onMouseOut.bind(this));

        // let
        this.Content = new TextBox({
            ...config,
            component: 'TextBox'
        }, el);
        config.spread.viewCell[config.rowIndex][config.colIndex] = this;

        if(parentNode) {
            parentNode.appendChild(el);
        }
        return el;
    };

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}

/**
 * 单元格:重绘合并状态
 */
Cell.prototype.refreshMerge = function() {
    let mergeinfo = this.data.spread.areaMerge.find(([x, y, rowspan, colspan]) =>
        x === this.data.rowIndex + this.data.spread.viewX &&
        y === this.data.colIndex + this.data.spread.viewY
    );

    if(this.data.colIndex === 0) {
        this.el.parentNode.style.height = this.data.spread.getRowHeight(this.data.rowIndex) + 'px';
    }
    if(this.data.rowIndex === 0) {
        this.el.parentNode.style.width = this.data.spread.getColWidth(this.data.colIndex) + 'px';
    }

    if(mergeinfo) {
        // console.log(this.data.rowIndex, this.data.colIndex);
        if(this.data.rowIndex - this.data.spread.freezeArea.top > 0) {
            this.el.setAttribute('rowspan', mergeinfo[2]);
        } else {
            // this.el.setAttribute('rowspan', mergeinfo[2] + this.data.rowIndex - this.data.spread.freezeArea.top);
            this.el.setAttribute('rowspan', 1);
        }

        this.el.setAttribute('colspan', mergeinfo[3]);
    } else {
        this.el.removeAttribute('rowspan');
        this.el.removeAttribute('colspan');
    }

    let mergeheadinfo = this.data.spread.areaMerge.find(([x, y, rowspan, colspan]) =>
        x <= this.data.rowIndex + this.data.spread.viewX &&
        x + rowspan > this.data.rowIndex + this.data.spread.viewX &&
        y <= this.data.colIndex + this.data.spread.viewY &&
        y + colspan > this.data.colIndex + this.data.spread.viewY &&
        !(x === this.data.rowIndex + this.data.spread.viewX && y === this.data.colIndex + this.data.spread.viewY));
    if(mergeheadinfo) {
        //console.log(this.data.rowIndex, this.data.colIndex);
        this.el.classList.add('hidden');
    } else {
        this.el.classList.remove('hidden');
    }
}

/**
 * 单元格:重绘选中状态
 */
Cell.prototype.refresh = function() {
    let colIndex = this.data.colIndex,
        rowIndex = this.data.rowIndex,
        _class = [];
    if(this.el.classList.contains('hidden')) {
        _class.push('hidden');
    }
    if(this.data.rowIndex >= this.data.spread.freezeArea.top) {
        rowIndex += this.data.spread.viewX;
    }
    if(this.data.colIndex >= this.data.spread.freezeArea.left) {
        colIndex += this.data.spread.viewY;
    }

    if(this.data.colIndex === this.data.spread.freezeArea.left) {
        _class.push('cell-freeze-left');
    }
    if(this.data.rowIndex === this.data.spread.freezeArea.top) {
        _class.push('cell-freeze-top');
    }

    //活动单元格
    if(this.data.spread.active[0] === rowIndex && this.data.spread.active[1] === colIndex) {
        _class.push('focus');
        if(this.isEdit === false) {
            this.el.removeChild(this.Content.el);
            this.el.appendChild(this.Content.render(this.Content.el));
            this.Content.el.value = this.data.spread.getData(rowIndex, colIndex);
            setTimeout(() => this.Content.el.focus(), 1);
            this.isEdit = true;
        }
    } else {
        if(this.isEdit === true) {
            this.el.removeChild(this.Content.el);
            this.el.appendChild(this.Content.render(this.Content.el));
            this.Content.el.innerHTML = this.data.spread.getData(rowIndex, colIndex);
            this.Content.el.focus();
            this.isEdit = false;
        }
        //选中单元格
        let td = this.data.spread.selected.find(([x, y]) => x === rowIndex && y === colIndex);
        if(td) {
            _class.push('selected');
        }
    }

    if (this.data.spread.selectedArea.type === 'cell') {

        let mergeinfo = this.data.spread.areaMerge.find(([x, y, rowspan, colspan]) =>
            rowIndex > x && rowIndex < x + rowspan &&
            colIndex > y && colIndex < y + colspan
        );
        if(mergeinfo) {
            //console.log(mergeinfo);
        }

        if (rowIndex == this.data.spread.selectedArea.x &&
            colIndex == this.data.spread.selectedArea.y) {
            _class.push('selected-area-init');
        }

        // //设置当前拖拽范围
        // if(this.data.spread.dragger.isStart) {
        //     if (rowIndex == this.data.spread.dragger.x2 - this.data.spread.dragger.x + this.data.spread.selectedArea.minx &&
        //         colIndex >= this.data.spread.dragger.y2 - this.data.spread.dragger.y + this.data.spread.selectedArea.miny &&
        //         colIndex <= this.data.spread.dragger.y2 - this.data.spread.dragger.y + this.data.spread.selectedArea.maxy) {
        //         _class.push('drag-area-top');
        //     }
        //     if (rowIndex == this.data.spread.dragger.x2 - this.data.spread.dragger.x + this.data.spread.selectedArea.maxx &&
        //         colIndex >= this.data.spread.dragger.y2 - this.data.spread.dragger.y + this.data.spread.selectedArea.miny &&
        //         colIndex <= this.data.spread.dragger.y2 - this.data.spread.dragger.y + this.data.spread.selectedArea.maxy) {
        //         _class.push('drag-area-bottom');
        //     }
        //     if (colIndex == this.data.spread.dragger.y2 - this.data.spread.dragger.y + this.data.spread.selectedArea.miny &&
        //         rowIndex >= this.data.spread.dragger.x2 - this.data.spread.dragger.x + this.data.spread.selectedArea.minx &&
        //         rowIndex <= this.data.spread.dragger.x2 - this.data.spread.dragger.x + this.data.spread.selectedArea.maxx) {
        //         _class.push('drag-area-left');
        //     }
        //     if (colIndex == this.data.spread.dragger.y2 - this.data.spread.dragger.y + this.data.spread.selectedArea.maxy &&
        //         rowIndex >= this.data.spread.dragger.x2 - this.data.spread.dragger.x + this.data.spread.selectedArea.minx &&
        //         rowIndex <= this.data.spread.dragger.x2 - this.data.spread.dragger.x + this.data.spread.selectedArea.maxx) {
        //         _class.push('drag-area-right');
        //     }
        // }
        if(this.data.spread.dragger.isStart) {
            let _topIndex = this.data.spread.dragger.x2 - this.data.spread.dragger.x + this.data.spread.selectedArea.minx,
                _leftIndex = this.data.spread.dragger.y2 - this.data.spread.dragger.y + this.data.spread.selectedArea.miny;
            let _top = Array(_topIndex).fill('').map((i, index) => this.data.spread.getRowHeight(index + _topIndex)).reduce((a, b) => a + b),
                _height = Array(this.data.spread.selectedArea.maxx + 1).slice(this.data.spread.selectedArea.minx).fill('').map((i, index) => this.data.spread.getRowHeight(index + this.data.spread.selectedArea.minx)).reduce((a, b) => a + b),
                _left = Array(_leftIndex).fill('').map((i, index) => this.data.spread.getColWidth(index + _leftIndex)).reduce((a, b) => a + b),
                _width = Array(this.data.spread.selectedArea.maxy + 1).slice(this.data.spread.selectedArea.miny).fill('').map((i, index) => this.data.spread.getColWidth(index + this.data.spread.selectedArea.miny)).reduce((a, b) => a + b);
            // console.log(_top, _height, _left, _width);
            this.data.spread.dragger.el.style.transform = 'translate(' + _left + 'px,' + _top + 'px)';
            this.data.spread.dragger.el.style.width = _width + 'px';
            this.data.spread.dragger.el.style.height = _height + 'px';
        }

        //设置当前范围
        if (rowIndex == this.data.spread.selectedArea.minx &&
            colIndex >= this.data.spread.selectedArea.miny &&
            colIndex <= this.data.spread.selectedArea.maxy) {
            _class.push('selected-area-top');
            this.selected.top = true;
        } else {
            this.selected.top = false;
        }
        if (rowIndex == this.data.spread.selectedArea.maxx &&
            colIndex >= this.data.spread.selectedArea.miny &&
            colIndex <= this.data.spread.selectedArea.maxy) {
            _class.push('selected-area-bottom');
            this.selected.bottom = true;
        } else {
            this.selected.bottom = false;
        }
        if (colIndex == this.data.spread.selectedArea.miny &&
            rowIndex >= this.data.spread.selectedArea.minx &&
            rowIndex <= this.data.spread.selectedArea.maxx) {
            _class.push('selected-area-left');
            this.selected.left = true;
        } else {
            this.selected.left = false;
        }
        if (colIndex == this.data.spread.selectedArea.maxy &&
            rowIndex >= this.data.spread.selectedArea.minx &&
            rowIndex <= this.data.spread.selectedArea.maxx) {
            _class.push('selected-area-right');
            this.selected.right = true;
        } else {
            this.selected.right = false;
        }

    } else if (this.data.spread.selectedArea.type === 'row') {

        if (rowIndex == this.data.spread.selectedArea.x - 1 && colIndex == 0) {
            _class.push('selected-area-init');
        }

        //设置当前范围
        // if (rowIndex == this.data.spread.selectedArea.minx - 1) {
        //     _class.push('selected-area-top');
        // }
        // if (rowIndex == this.data.spread.selectedArea.maxx - 1) {
        //     _class.push('selected-area-bottom');
        // }

    } else if (this.data.spread.selectedArea.type === 'col') {
        if (rowIndex == 0 && colIndex == this.data.spread.selectedArea.y - 1) {
            _class.push('selected-area-init');
        }

        //设置当前范围
        // if (colIndex == this.data.spread.selectedArea.miny - 1) {
        //     _class.push('selected-area-left');
        // }
        // if (colIndex == this.data.spread.selectedArea.maxy - 1) {
        //     _class.push('selected-area-right');
        // }
    }

    let _className = _class.join(' '),
        _oldClassName = this.el.className;
    if(_className !== _oldClassName && (_className != '' || _oldClassName !== '')) {
        this.el.className = _className;
    }
}

Cell.prototype.onMouseDown = function(e) {
    if ((e.offsetY < 5 && this.selected.top) ||
        (e.offsetY > e.target.offsetHeight - 5 && this.data.spread.viewCell[this.data.rowIndex + 1][this.data.colIndex].selected.top) ||
        (e.offsetY > e.target.offsetHeight - 5 && this.selected.bottom) ||
        (e.offsetY < 5 && this.data.spread.viewCell[this.data.rowIndex - 1][this.data.colIndex].selected.bottom) ||
        (e.offsetX < 5 && this.selected.left) ||
        (e.offsetX > e.target.offsetWidth - 5 && this.data.spread.viewCell[this.data.rowIndex][this.data.colIndex + 1].selected.left) ||
        (e.offsetX > e.target.offsetWidth - 5 && this.selected.right) ||
        (e.offsetX < 5 && this.data.spread.viewCell[this.data.rowIndex][this.data.colIndex - 1].selected.right)
    ) {
        this.data.spread.dragger.isStart = true;
        this.data.spread.dragger.x = e.target.data.rowIndex;
        this.data.spread.dragger.y = e.target.data.colIndex;
    } else {
        this.data.spread.dragger.isStart = false;
    }
}

Cell.prototype.onMouseMove = function(e) {
    try {
        if ((e.offsetY < 5 && this.selected.top) ||
            (e.offsetY > e.target.offsetHeight - 5 && this.data.spread.viewCell[this.data.rowIndex + 1][this.data.colIndex].selected.top)
        ) {
            this.el.classList.add('cursor-grab');
        } else if(
            (e.offsetY > e.target.offsetHeight - 5 && this.selected.bottom) ||
            (e.offsetY < 5 && this.data.rowIndex > 0 && this.data.spread.viewCell[this.data.rowIndex - 1][this.data.colIndex].selected.bottom)
        ) {
            this.el.classList.add('cursor-grab');
        } else if(
            (e.offsetX < 5 && this.selected.left) ||
            (e.offsetX > e.target.offsetWidth - 5 && this.data.spread.viewCell[this.data.rowIndex][this.data.colIndex + 1].selected.left)
        ) {
            this.el.classList.add('cursor-grab');
        } else if(
            (e.offsetX > e.target.offsetWidth - 5 && this.selected.right) ||
            (e.offsetX < 5 && this.data.colIndex > 0 && this.data.spread.viewCell[this.data.rowIndex][this.data.colIndex - 1].selected.right)
        ) {
            this.el.classList.add('cursor-grab');
        } else {
            this.el.classList.remove('cursor-grab');
        }
    } catch (error) {
        console.log(error);
    }
}

Cell.prototype.onMouseOut = function() {
    if(this.el.classList.contains('cursor-grab')) {
        this.el.classList.remove('cursor-grab');
    }
}

/**
 * @class 行
 */
function Row(config, pNode) {

    this.render = function(parentNode) {
        let el = document.createElement("tr");
        el.data = {
            ...config,
            component: 'Row'
        };
        Array(config.colNum).fill('').map((i, colIndex) => {
            new Cell({
                ...config,
                colIndex: colIndex
            }, el);
        });

        if(parentNode) {
            parentNode.appendChild(el);
        }
        return el;
    };

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}

/**
 * @class 表格
 */
function Table(config, pNode) {
    this.el = null;

    this.refresh = function() {
        let _width = Array(config.spread.colNum).fill(null).map((i, index) => config.spread.getColWidth(index)).reduce((a, b) => a + b);
        let _height = Array(config.spread.rowNum).fill(null).map((i, index) => config.spread.getRowHeight(index)).reduce((a, b) => a + b);
        this.el.style.width = _width + 'px';
        this.el.style.height = _height + 'px';
    };

    this.render = function(parentNode) {
        let el = document.createElement("table");
        el.data = {
            ...config,
            component: 'Table'
        };
        el.appendChild(document.createElement("tbody"));

        Array(config.rowNum).fill('').map((i, rowIndex) => {
            el.childNodes[0].appendChild(
                new Row({
                    ...config,
                    rowIndex
                }).render()
            )
        });

        if(parentNode) {
            parentNode.appendChild(el);
        }
        return el;
    };

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}

/**
 * 右键菜单项
 */
function ContextMenuItem(config, pNode) {
    this.el = null;
    this.txtEl = null;
    this.data = config;
    this.onInit = config.menu.onInit;

    this.render = function(parentNode) {
        let el = document.createElement("li");
        this.txtEl = document.createElement("span");
        this.txtEl.innerHTML = config.menu.text;
        el.appendChild(this.txtEl);
        this.keyEl = document.createElement("key");
        this.keyEl.innerHTML = config.menu.key;
        el.appendChild(this.keyEl);
        // this.split = document.createElement("div");
        // this.split.classList.add("header-split");
        // el.appendChild(this.split);
        el.data = config;

        if(parentNode) {
            parentNode.appendChild(el);
            config.menu.onClick && el.addEventListener('mousedown', e => {
                if(e.buttons === 1) {
                    config.menu.onClick.call(this, e);
                    this.data.hide();
                }
            });
        }

        return el;
    }

    //更新状态
    this.refresh = function() {
    }

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}


/**
 * 右键菜单
 */
function ContextMenu(config, pNode) {
    this.el = null;
    this.data = {
        ...config, 
        menuEls: []
    };

    let el = null;

    this.refresh = function() {
        this.data.forEach((i, index) => {
            i.refresh();
        });
    }

    this.hide = function() {
        el.style.left = '-999px';
        el.style.top = '-999px';
        el.classList.remove('context-menu-show');
    }

    this.show = function(x, y) {
        this.data.menuEls.forEach(i => {
            if(i.onInit) {
                let state = i.onInit(i);
                if(state) {
                    if(state.hidden) {
                        i.el.classList.add('hidden');
                    } else {
                        i.el.classList.remove('hidden');
                    }
                }
            }
        });

        this.el.style.left = x + 'px';
        this.el.style.top = y + 'px';
        this.el.classList.add('context-menu-show');
    }

    this.render = function(parentNode) {
        el = document.createElement("ul");
        el.classList.add('context-menu');
        //el.data = {...config, menuEls: []};
        config.menus.map((i, index) => {
            let item = new ContextMenuItem({
                ...config,
                menu: i,
                hide: this.hide
            }, el);
            this.data.menuEls.push(item);
            //el.data.menuEls.push(item);
        });
        document.body.appendChild(el);
        if(parentNode) {
            parentNode.addEventListener('mousedown', e => {
                if(e.buttons === 1) {
                    this.hide();
                } else if(e.buttons === 2) {
                    this.show(e.pageX, e.pageY);
                    //console.log(e.pageX, e.pageY, e.target.tagName, e);
                    e.preventDefault();
                    e.stopPropagation();
                }
            });
        }
        return el;
    }

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}
/**
 * @class 表格页
 */
function Spread(config, pNode) {
    this.el = null;

    /**
     * 默认单元格宽度
     */
    let _cellDefaultWidth = 100;
    let _cellDefaultHeight = 25;
    /**
     * 是否为编辑状态
     */
    let _isEdit = true;
    /**
     * 单元格宽度
     */
    let _colWidth = [];
    /**
     * 单元格高度
     */
    let _rowHeight = [];

    /**
     * 显示横坐标
     */
    let _viewX = 0;
    /**
     * 显示纵坐标
     */
    let _viewY = 0;

    /**
     * 获取列宽度
     */
    this.getColWidth = function(x) {
        return _colWidth[x] || _cellDefaultWidth;
    }

    /**
     * 获取行高度
     */
    this.getRowHeight = function(y) {
        return _rowHeight[y] || _cellDefaultHeight;
    }

    Object.defineProperties(this, {
        /**
         * 当前头部的X坐标
         */
        viewX: {
            get() {
                return _viewX;
            },
            set(value) {
                if(value < 0) value = 0;
                else if(value > this.maxRowCount - this.minRowCount) {
                    value = this.maxRowCount - this.minRowCount;
                }
                this.header.left.setStartIndex(value);
                _viewX = value;
            }
        },
        /**
         * 当前左侧头部的Y坐标
         */
        viewY: {
            get() {
                return _viewY;
            },
            set(value) {
                if(value < 0) value = 0;
                else if(value > this.maxColCount - this.minColCount) {
                    value = this.maxColCount - this.minColCount;
                }
                this.header.top.setStartIndex(value);
                _viewY = value;
            }
        },
        /**
         * 最小行数（根据页面大小判断）
         */
        minRowCount: {
            get() {
                let _count = 0, _height = 0;
                while(_height <= window.innerHeight) {
                    _height += this.getRowHeight(_count);
                    _count++;
                }
                return _count;
            }
        },
        /**
         * 最大行数
         */
        maxRowCount: {
            get() {
                return Math.max(this.viewData.length, 40);
            }
        },
        /**
         * 最小列数（根据页面大小判断）
         */
        minColCount: {
            get() {
                let _count = 0, _width = 0;
                while(_width <= window.innerWidth) {
                    _width += this.getColWidth(_count);
                    _count++;
                }
                return _count;
            }
        },
        /**
         * 最大列数
         */
        maxColCount: {
            get() {
                return Math.max(Math.max.apply(0, this.viewData.filter(i => i).map(i => i.length)), 20);
            }
        }
    })
    /**
     * 行数
     */
    this.rowNum = 40;
    /**
     * 列数
     */
    this.colNum = 20;
    /**
     * 所有数据
     */
    this.data = [];
    /**
     * 当前显示数据
     */
    this.viewData = [[]];
    /**
     * 当前显示文本框
     */
    this.viewCell = [];
    /**
     * 已选中区域
     */
    this.selected = [];
    /**
     * 已框选区域
     */
    this.selectedArea = {
        x: 0,
        y: 0,
        x2: 0,
        y2: 0,
        get minx() {
            return Math.min(this.x, this.x2)
        },
        set minx(value) {
            if(this.x <= this.x2) {
                this.x2 = value;
            } else {
                this.x = value;
            }
        },
        get miny() {
            return Math.min(this.y, this.y2)
        },
        set miny(value) {
            if(this.y <= this.y2) {
                this.y2 = value;
            } else {
                this.y = value;
            }
        },
        get maxx() {
            return Math.max(this.x, this.x2)
        },
        set maxx(value) {
            if(this.x <= this.x2) {
                this.x = value;
            } else {
                this.x2 = value;
            }
        },
        get maxy() {
            return Math.max(this.y, this.y2)
        },
        set maxy(value) {
            if(this.y <= this.y2) {
                this.y = value;
            } else {
                this.y2 = value;
            }
        },
        isStart: false,
        isActive: false,
        type: 'cell'
    };
    /**
     * 当前活动单元格
     */
    this.active = [];
    /**
     * 当前绑定表格区域（边缘冻结表格）
     */
    this.panels = {
        main: null,
        top: null,
        right: null,
        bottom: null,
        left: null,
        topleft: null,
        topright: null,
    };
    /**
     * 冻结区域
     */
    this.freezeArea = {
        top: 2,
        left: 1,
        right: 1,
        bottom: 0
    };
    /**
     * 单元格合并区域
     */
    this.areaMerge = [
        [3, 3, 2, 4]
    ];
    /**
     * 合并后隐藏区域（在合并区域调整后初始化
     */
    this.areaMergeHideCell = [];
    /**
     * 顶部与左侧头部区域
     */
    this.header = {
        top: null,
        left: null
    };
    /**
     * 滚动条
     */
    this.scroll = {
        /**
         * 纵向滚动条
         */
        vertical: null,
        /**
         * 横向滚动条
         */
        horizontal: null,
        location: 0,
        location2: 0,
        isStart: false,
    };
    /**
     * 拖拽
     */
    this.dragger = {
        el: null,
        isStart: false,
        x: 0,
        y: 0,
        x2: 0,
        y2: 0
    }
    this.table = null;

    //设置值
    this.setData = function(x, y, value = '') {
        if(!this.viewData[x]) {
            this.viewData[x] = [];
        }
        this.viewData[x][y] = value;
        this.viewCell[x - this.viewX][y - this.viewY].el.value = value;
    }

    //获取值
    this.getData = function(x, y) {
        if(!this.viewData[x] || this.viewData[x][y] === undefined) {
            return '';
        }
        return this.viewData[x][y];
    }

    /**
     * 设置列宽度
     */
    this.setColWidth = function(colIndex, width) {
        _colWidth[colIndex] = width;
        spread.viewCell.map((i, index) => i[colIndex]).forEach(i => i.el.style.width = width + 'px');
    }

    this.setRowHeight = function(rowIndex, height) {
        _rowHeight[rowIndex] = height;
        spread.viewCell[rowIndex].forEach(i => i.forEach(item => item.el.style.height = height + 'px'));
    }

    //设置当前焦点单元格
    this.setFocus = function(x, y) {
        this.active = [];
        this.selected = [[x, y]];
        this.selectedArea.x = x;
        this.selectedArea.y = y;
        this.selectedArea.x2 = x;
        this.selectedArea.y2 = y;
        //spread.viewCell[x][y].el.click();

        this.refreshSelected();
        this.header.top.refresh();
        this.header.left.refresh();
    }

    /**
     * 设置冻结区域（参数格式：{[top:],[left:],[right:],[bottom:]}）
     */
    this.setFreezeArea = function(config) {
        if(config.x) {

        }
    }

    //按键事件
    this.inputKeyPress = function(x, y, e) {
        switch (e.keyCode) {
            case 38:
                if(x > 0) {
                    this.setFocus(x - 1, y);
                }
                break;
            case 13:
            case 40:
                if(x < this.viewData.length - 1) {
                    this.setFocus(x + 1, y);
                }
                break;
            case 37:
                if(y > 0) {
                    this.setFocus(x, y - 1);
                }
                break;
            case 39:
                if(y < this.viewData[0].length - 1) {
                    this.setFocus(x, y + 1);
                }
                break;
            default:
                break;
        }
        if(e.keyCode === 13) {
            if(x < this.viewData.length - 1) {
                this.setFocus(x + 1, y);
            }
        }
        if([13, 37, 38, 39, 40].includes(e.keyCode)) {
            e.stopPropagation();
            e.preventDefault();
        }
    }

    /**
     * 重绘选中状态
     */
    this.refreshSelected = function() {
        this.viewCell.forEach(row => row.forEach(cell => cell.refresh()));
    }

    /**
     * 重绘合并状态
     */
    this.refreshMerge = function() {
        this.viewCell.forEach(row => row.forEach(cell => cell.refreshMerge()));
    }

    /**
     * 根据坐标点获取真实坐标
     */
    this.getCellPoint = function(x, y) {

    }

    /**
     * 设置合并单元格
     */
    this.setMerge = function(x, y, rowspan, colspan) {
        let mergeIndex = this.areaMerge.findIndex(([x1, y1, rowspan, colspan]) => x1 === x && y1 === y);
        if(mergeIndex >= 0) {
            if(rowspan > 1 || colspan > 1) {
                this.areaMerge[mergeIndex][2] = rowspan;
                this.areaMerge[mergeIndex][3] = colspan;
            } else {
                this.areaMerge.splice(mergeIndex, 1);
            }
        } else {
            this.areaMerge.push([x, y, rowspan, colspan]);
        }
        this.refreshMerge();
        this.selectedArea.x = x;
        this.selectedArea.x2 = x;
        this.selectedArea.y = y;
        this.selectedArea.y2 = y;
        this.refreshSelected();
    }

    this.render = function(parentNode) {
        let el = document.createElement("div");
        el.classList.add('haku-spreadsheet');
        //el.data = config;

        //构造左侧头部
        let headerbodyleft = document.createElement("div");
        headerbodyleft.classList.add('header-body-left');
        let leftHeader = new HeaderList({
            ...config,
            spread: this,
            headertype: 'left',
            count: this.rowNum,
            onInit() {
                //this.classList.add('header-list-left');
            }
        }, headerbodyleft);
        this.header.left = leftHeader;
        el.appendChild(headerbodyleft);

        //构造顶部头部
        let headerbodytop = document.createElement("div");
        headerbodytop.classList.add('header-body-top');
        let topHeader = new HeaderList({
            ...config,
            spread: this,
            headertype: 'top',
            count: this.colNum,
            onInit() {
                //this.classList.add('header-list-top');
            }
        }, headerbodytop);
        this.header.top = topHeader;
        el.appendChild(headerbodytop);

        //构造表格
        let fixedMain = document.createElement("div");
        this.panels.main = fixedMain;
        fixedMain.classList.add('haku-spreadsheet-main');

        //拖拽区域框
        let dragArea = document.createElement("div");
        dragArea.classList.add("dragarea");
        fixedMain.appendChild(dragArea);
        this.dragger.el = dragArea;


        let fixedMainBody = document.createElement("div");
        fixedMainBody.classList.add('haku-spreadsheet-main-body');

        let tableMain = new Table({
            ...config,
            freeze: '',
            spread: this,
            rowNum: this.rowNum,
            colNum: this.colNum,
            onInit() {
                this.classList.add('haku-table', 'haku-table-main');
            }
        }, fixedMainBody);
        this.table = tableMain;

        fixedMain.appendChild(fixedMainBody);
        el.appendChild(fixedMain);

        let scrollVertical = new Scroll({
            type: 'vertical',
            spread: this
        }, el);
        this.scroll.vertical = scrollVertical;

        let scrollHorizontal = new Scroll({
            type: 'horizontal',
            spread: this
        }, el);
        this.scroll.horizontal = scrollHorizontal;

        if(parentNode) {
            parentNode.appendChild(el);
        }
        this.el = el;

        //绑定一些基础事件
        el.addEventListener('input', e => {
            //data-txt
            if(e.target.classList.contains('data-txt')) {
                this.setData(
                    e.target.data.rowIndex + this.viewX,
                    e.target.data.colIndex + this.viewY,
                    e.target.value
                );
            }
        });
        document.body.addEventListener('keydown', e => {
            if([13, 37, 38, 39, 40].includes(e.keyCode)) {
                if(this.selected.length == 1) {
                    let x = this.selected[0][0],
                        y = this.selected[0][1];
                    switch (e.keyCode) {
                        case 38:
                            if(x > 0) {
                                this.setFocus(x - 1, y);
                            }
                            break;
                        case 13:
                        case 40:
                            if(x < this.viewData.length - 1) {
                                this.setFocus(x + 1, y);
                            }
                            break;
                        case 37:
                            if(y > 0) {
                                this.setFocus(x, y - 1);
                            }
                            break;
                        case 39:
                            if(y < this.viewData[0].length - 1) {
                                this.setFocus(x, y + 1);
                            }
                            break;
                        default:
                            break;
                    }
                }
            } else if(this.selected.length > 0) {
                this.active = this.selected[0];
                this.refreshSelected();
                //this.setData(this.selected[0][0], this.selected[0][1], this.viewData[this.selected[0][0]][this.selected[0][1]] + e.key);
                // this.viewCell[this.selected[0][0]][this.selected[0][1]].el.onkeypress(e);
            }
        })
        //鼠标拖拽框选
        el.addEventListener('mousedown', e => {
            if(!e.target || !e.target.data) {
                return;
            }
            if(this.dragger.isStart) {
                /**
                 * 拖拽在单元格内事件处理
                 */
            } else {
                let _refreshSelect = () => {
                    this.selectedArea.isStart = true;
                    this.refreshSelected();
                    this.header.top.refresh();
                    this.header.left.refresh();
                };
                switch(e.target.data.component) {
                    case 'Cell':
                    case 'TextBox':
                        let colIndex = e.target.data.colIndex,
                            rowIndex = e.target.data.rowIndex;
                        //单元格状态下判断取消
                        if(e.buttons !== 1 && this.selected.filter(([x, y]) => x === rowIndex && y === colIndex).length > 0) {
                            return;
                        }
                        this.selectedArea.type = 'cell';
                        if(e.target.data.rowIndex >= this.freezeArea.top) {
                            rowIndex += this.viewX;
                        }
                        if(e.target.data.colIndex >= this.freezeArea.left) {
                            colIndex += this.viewY;
                        }
                        this.selectedArea.x = rowIndex;
                        this.selectedArea.y = colIndex;
                        this.selectedArea.x2 = rowIndex;
                        this.selectedArea.y2 = colIndex;

                        let tdIndex = this.selected.findIndex(([x, y]) => x === rowIndex && y === colIndex);
                        if(tdIndex >= 0 && this.selected.length === 1) {
                            this.selected = [[rowIndex, colIndex]];
                            this.active = [rowIndex, colIndex];
                            this.selectedArea.isStart = false;
                        } else {
                            this.selected = [[rowIndex, e.target.data.colIndex]];
                            this.active = [];
                        }
                        _refreshSelect();
                        break;

                    case 'HeaderCell':
                        if(e.target.data.headertype === 'left') {
                            //行状态下判断取消
                            if(e.buttons !== 1 && (e.target.data.index > this.selectedArea.maxx || e.target.data.index < this.selectedArea.minx)) {
                                return;
                            }
                            this.selectedArea.type = 'row';
                            this.selectedArea.x = e.target.data.index;
                            this.selectedArea.x2 = e.target.data.index;
                            this.selected = Array(this.viewCell[0].length).fill(null).map((i, index) => ([e.target.data.index - 1, index]));
                        } else if(e.target.data.headertype === 'top') {
                            //列状态下判断取消
                            if(e.buttons !== 1 && (e.target.data.index > this.selectedArea.maxy || e.target.data.index < this.selectedArea.miny)) {
                                return;
                            }
                            this.selectedArea.type = 'col';
                            this.selectedArea.y = e.target.data.index;
                            this.selectedArea.y2 = e.target.data.index;
                            this.selected = Array(this.viewCell.length).fill(null).map((i, index) => ([index, e.target.data.index - 1]));
                        }
                        _refreshSelect();
                        break;

                    case 'ScrollBar':
                        if(e.target.data.type == 'vertical') {
                            this.scroll.location = e.clientY - this.scroll.vertical.el.offsetTop - this.scroll.vertical.value;
                            this.scroll.type = 'vertical';
                        } else if (e.target.data.type == 'horizontal') {
                            this.scroll.location = e.clientX - this.scroll.horizontal.el.offsetLeft - this.scroll.horizontal.value;
                            this.scroll.type = 'horizontal';
                        }
                        // console.log(e);
                        this.scroll.isStart = true;
                        break;
                }
            }

            // console.log(e.target.data.component);
        });

        document.body.addEventListener('mousemove', e => {
            //开始选择区域
            if(this.selectedArea.isStart === true) {
                if(!e.target || !e.target.data) {
                    return;
                }
                //验证和鼠标按下的选择类型是否相同
                if(e.target.data.headertype) {
                    if(e.target.data.headertype === 'left') if(this.selectedArea.type !== 'row') return;
                    else if(e.target.data.headertype === 'top') if(this.selectedArea.type !== 'col') return;
                } else if(this.selectedArea.type !== 'cell') return;

                if(e.target.data.headertype) {
                    if(e.target.data.headertype === 'left') {
                        this.selectedArea.x2 = e.target.data.index;
                        this.selected = [].concat.apply([], Array(this.viewCell[0].length).fill(null).map((i, index) => {
                            return (Array(this.selectedArea.maxx - this.selectedArea.minx + 1).fill(null).map((o, oIndex) => ([oIndex + this.selectedArea.minx - 1, index])))
                        }))
                    } else if(e.target.data.headertype === 'top') {
                        this.selectedArea.y2 = e.target.data.index;
                        this.selected = [].concat.apply([], Array(this.viewCell.length).fill(null).map((i, index) => {
                            return (Array(this.selectedArea.maxy - this.selectedArea.miny + 1).fill(null).map((o, oIndex) => ([index, oIndex + this.selectedArea.miny - 1])))
                        }))
                    }
                } else {
                    let colIndex = e.target.data.colIndex,
                        rowIndex = e.target.data.rowIndex;

                    /**
                     * 判断是否在冻结区域内
                     */
                    if(e.target.data.rowIndex >= this.freezeArea.top) {
                        rowIndex += this.viewX;
                    }
                    if(e.target.data.colIndex >= this.freezeArea.left) {
                        colIndex += this.viewY;
                    }

                    if(e.target.data && e.target.data.rowIndex != undefined) {
                        this.selectedArea.x2 = rowIndex;
                        this.selectedArea.y2 = colIndex;
                        this.selected = [];

                        for (let x = this.selectedArea.minx; x <= this.selectedArea.maxx; x++) {
                            for (let y = this.selectedArea.miny; y <= this.selectedArea.maxy; y++) {
                                //if(!spread.areaMerge.find(([x1, y1, rowspan, colspan]) => x > x1 + rowspan && y > y1 + colspan)) {
                                    this.selected.push([x, y]);
                                //} else {
                                //}
                            }
                        }
                    } else {
                    }
                }

                //使用递归完善选择范围（针对合并单元格
                let _fn = (minx, miny, maxx, maxy) => {
                    let _minx = minx, _miny = miny, _maxx = maxx, _maxy = maxy;
                    for (let x = minx; x <= maxx; x++) {
                        for (let y = miny; y <= maxy; y++) {
                            let mergecell = spread.areaMerge.find(([x1, y1, rowspan, colspan]) =>
                                x >= x1 &&
                                x < x1 + rowspan &&
                                y >= y1 &&
                                y < y1 + colspan);
                            if(mergecell) {
                                _minx = Math.min(_minx, mergecell[0]);
                                _miny = Math.min(_miny, mergecell[1]);
                                _maxx = Math.max(_maxx, mergecell[0] + mergecell[2] - 1);
                                _maxy = Math.max(_maxy, mergecell[1] + mergecell[3] - 1);
                            }
                        }
                    }
                    if(_minx !== minx || _maxx !== maxx || _miny !== miny || _maxy !== maxy) {
                        _fn(_minx, _miny, _maxx, _maxy);
                    } else {
                        if(this.selectedArea.x <= this.selectedArea.x2) {
                            this.selectedArea.x = _minx;
                            this.selectedArea.x2 = _maxx;
                        } else {
                            this.selectedArea.x = _maxx;
                            this.selectedArea.x2 = _minx;
                        }
                        if(this.selectedArea.y <= this.selectedArea.y2) {
                            this.selectedArea.y = _miny;
                            this.selectedArea.y2 = _maxy;
                        } else {
                            this.selectedArea.y = _maxy;
                            this.selectedArea.y2 = _miny;
                        }
                    }
                };
                _fn(this.selectedArea.minx,
                    this.selectedArea.miny,
                    this.selectedArea.maxx,
                    this.selectedArea.maxy);

                this.refreshSelected();
                this.header.top.refresh();
                this.header.left.refresh();
            }
            //开始拖拽区域
            else if(this.dragger.isStart === true) {
                if(!e.target || !e.target.data) {
                    return;
                }
                let colIndex = e.target.data.colIndex,
                    rowIndex = e.target.data.rowIndex;

                this.dragger.x2 = rowIndex;
                this.dragger.y2 = colIndex;

                this.refreshSelected();
                this.header.top.refresh();
                this.header.left.refresh();
            }
            //开始滚动滚动条
            else if(this.scroll.isStart) {
                if(this.scroll.type == 'vertical') {
                    this.viewX = parseInt((e.pageY - this.scroll.vertical.el.offsetTop - this.scroll.location) / this.scroll.vertical.el.offsetHeight * this.maxRowCount);// - this.minRowCount
                    this.scroll.vertical.refreshLocation();
                } else if (this.scroll.type == 'horizontal') {
                    this.viewY = parseInt((e.pageX - this.scroll.horizontal.el.offsetLeft - this.scroll.location) / this.scroll.horizontal.el.offsetWidth * this.maxColCount);// - this.minRowCount
                    this.scroll.horizontal.refreshLocation();
                }
            }
        });
        document.body.addEventListener('mouseup', e => {
            this.selectedArea.isStart = false;
            this.dragger.isStart = false;
            this.scroll.isStart = false;
        });
        //滚轮滚动
        el.addEventListener('wheel', e => {
            if(e.deltaY != 0) {
                if(e.deltaY > 0) {
                    this.viewX += 3;
                } else if(e.deltaY < 0) {
                    this.viewX -= 3;
                }
                this.scroll.vertical.refreshLocation();
            }
            if(e.deltaX != 0) {
                if(e.deltaX > 0) {
                    this.viewY += 3;
                } else if(e.deltaX < 0) {
                    this.viewY -= 3;
                }
                this.scroll.horizontal.refreshLocation();
            }

            for (let x = 0; x < this.viewCell.length; x++) {
                for (let y = 0; y < this.viewCell[x].length; y++) {
                    let _x = x, _y = y;
                    if(x < this.freezeArea.top) {

                    } else {
                        _x += this.viewX;
                    }
                    if(y < this.freezeArea.left) {

                    } else {
                        _y += this.viewY;
                    }
                    if(this.viewData[_x] && this.viewData[_x][_y]) {
                        this.viewCell[x][y].Content.el.innerHTML = this.viewData[_x][_y];
                    } else {
                        this.viewCell[x][y].Content.el.innerHTML = "";
                    }
                }
            }

            this.refreshSelected();
            this.refreshMerge();
            this.header.top.refresh();
            this.header.left.refresh();
        });

        window.addEventListener('resize', e => {
            this.scroll.vertical.refresh();
            this.scroll.horizontal.refresh();
            this.scroll.vertical.refreshLocation();
            this.scroll.horizontal.refreshLocation();
        })

        this.refreshSelected();
        this.refreshMerge();
        this.table.refresh();
        setTimeout(() => {
            this.scroll.vertical.refresh();
            this.scroll.horizontal.refresh();
        }, 10);
        return el;
    };

    /**
     * 初始化
     */
    (() => {
        _colWidth = new Array(this.rowNum).fill(_cellDefaultWidth);
        _rowHeight = new Array(this.colNum).fill(_cellDefaultHeight);
        this.viewCell = new Array(this.rowNum).fill(null).map(i => []).map(i => new Array(this.colNum).fill('').map(i => []));
    })();

    if(pNode) {
        this.el = this.render(pNode);
        if(config.onInit) {
            config.onInit.call(this.el);
        }
    }
}

console.time('页面加载');

let spread = new Spread();
spreadEl = spread.render(document.body);

let menu = new ContextMenu({
    menus: [
        {
            text: '复制',
            key: 'ctrl+c',
            onInit(e) {

            },
            onClick(e) {

            }
        }, {
            text: '合并单元格',
            key: 'ctrl+m',
            onInit(e) {
                return {
                    hidden: spread.selected.length <= 1 || spread.selectedArea.type !== 'cell'
                }
            },
            onClick(e) {
                spread.setMerge(
                    spread.selectedArea.minx,
                    spread.selectedArea.miny,
                    spread.selectedArea.maxx - spread.selectedArea.minx + 1,
                    spread.selectedArea.maxy - spread.selectedArea.miny + 1
                );
            }
        }, {
            text: '拆分单元格',
            key: 'ctrl+m',
            onInit(e) {
                return {
                    hidden: true
                }
            },
            onClick(e) {
                if(e && e.data) {
                    console.log(e);
                }
            }
        }
    ]
}, spreadEl);

window.spread = spread;
spreadEl.classList.add('init');
setTimeout(() => {
    spreadEl.classList.add('animeinit');
}, 200);

document.oncontextmenu = function(ev) {
    return false;    //屏蔽右键菜单
}

console.timeEnd('页面加载');